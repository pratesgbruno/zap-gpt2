'use strict';var a0_0x1d1851=a0_0x4e58;(function(_0x5d5dbd,_0x484c3c){var _0x215784=a0_0x4e58,_0x166711=_0x5d5dbd();while(!![]){try{var _0x10c334=parseInt(_0x215784(0xdf))/0x1*(-parseInt(_0x215784(0xaf))/0x2)+parseInt(_0x215784(0x130))/0x3*(parseInt(_0x215784(0xf6))/0x4)+-parseInt(_0x215784(0x123))/0x5+-parseInt(_0x215784(0xc2))/0x6*(parseInt(_0x215784(0x115))/0x7)+parseInt(_0x215784(0x114))/0x8+parseInt(_0x215784(0xc6))/0x9*(-parseInt(_0x215784(0xfd))/0xa)+-parseInt(_0x215784(0xb1))/0xb*(-parseInt(_0x215784(0xd5))/0xc);if(_0x10c334===_0x484c3c)break;else _0x166711['push'](_0x166711['shift']());}catch(_0x20d160){_0x166711['push'](_0x166711['shift']());}}}(a0_0x4013,0x7b8cc));var __create=Object[a0_0x1d1851(0xd0)],__defProp=Object[a0_0x1d1851(0x10c)],__getOwnPropDesc=Object[a0_0x1d1851(0xe0)],__getOwnPropNames=Object[a0_0x1d1851(0x11f)],__getProtoOf=Object[a0_0x1d1851(0x122)],__hasOwnProp=Object['prototype'][a0_0x1d1851(0xa7)],__copyProps=(_0x523b45,_0x132c01,_0x3ee53b,_0x5c7149)=>{var _0x21098f=a0_0x1d1851;if(_0x132c01&&typeof _0x132c01==='object'||typeof _0x132c01===_0x21098f(0x13d)){for(let _0x38fc7b of __getOwnPropNames(_0x132c01))if(!__hasOwnProp[_0x21098f(0xc7)](_0x523b45,_0x38fc7b)&&_0x38fc7b!==_0x3ee53b)__defProp(_0x523b45,_0x38fc7b,{'get':()=>_0x132c01[_0x38fc7b],'enumerable':!(_0x5c7149=__getOwnPropDesc(_0x132c01,_0x38fc7b))||_0x5c7149['enumerable']});}return _0x523b45;},__toESM=(_0x30d692,_0x5714c4,_0x2831c0)=>(_0x2831c0=_0x30d692!=null?__create(__getProtoOf(_0x30d692)):{},__copyProps(_0x5714c4||!_0x30d692||!_0x30d692[a0_0x1d1851(0xf4)]?__defProp(_0x2831c0,a0_0x1d1851(0x109),{'value':_0x30d692,'enumerable':!![]}):_0x2831c0,_0x30d692)),import_wppconnect=__toESM(require(a0_0x1d1851(0x104)),0x1);async function delay(_0x1648e7){return await new Promise(_0x4847e1=>setTimeout(_0x4847e1,_0x1648e7));}var import_node=require(a0_0x1d1851(0xc4)),allLastMessagesMap=new Map();function isValidMessage(_0x8c0c39){var _0xbe0dff=a0_0x1d1851;return!_0x8c0c39[_0xbe0dff(0x133)]&&_0x8c0c39[_0xbe0dff(0x131)]!==_0xbe0dff(0xa6);}async function sendMessagesWithDelay({messages:_0x13695b,client:_0x425dfb,targetNumber:_0x4b7d51,activeChatsHistory:_0x59810b,currentMessage:_0x1f614b,excludedNumbersIntervention:_0x3cc3fa}){var _0x22a2e5=a0_0x1d1851;for(const [_0x3695f8,_0x3639f6]of _0x13695b[_0x22a2e5(0x13c)]()){await delay(0x1f4);const _0xe1e789=await _0x425dfb['getMessages'](_0x4b7d51,{'count':0x5,'direction':_0x22a2e5(0xcf),'fromMe':!![]});!allLastMessagesMap[_0x22a2e5(0xdb)](_0x4b7d51)&&allLastMessagesMap['set'](_0x4b7d51,[]);let _0x584398=allLastMessagesMap['get'](_0x4b7d51);const _0xa385da=_0xe1e789[_0x22a2e5(0x11b)](_0x357528=>!_0x584398[_0x22a2e5(0x110)](_0x2a7636=>_0x2a7636['id']===_0x357528['id']));_0x584398=[..._0xa385da,..._0x584398]['sort']((_0x2d8f12,_0x34102e)=>_0x2d8f12['timestamp']-_0x34102e[_0x22a2e5(0xca)])[_0x22a2e5(0xbf)](0x0,0x32),allLastMessagesMap[_0x22a2e5(0x117)](_0x4b7d51,_0x584398);const _0x8d80b3=await isMissingMessages({'activeChatsHistory':_0x59810b,'chatId':_0x4b7d51,'lastMessages':_0x584398});if(_0x8d80b3){console[_0x22a2e5(0xac)]('Há\x20mensagens\x20enviadas\x20por\x20humanos\x20na\x20conversa,\x20parando\x20automação...'),_0x3cc3fa['set'](_0x4b7d51,!![]),setTimeout(()=>{var _0x3ab31f=_0x22a2e5;_0x3cc3fa[_0x3ab31f(0xdb)](_0x4b7d51)&&_0x3cc3fa[_0x3ab31f(0x111)](_0x4b7d51);},Number(process['env'][_0x22a2e5(0xc1)])*0x3c*0x3c*0x3e8);return;}await _0x425dfb[_0x22a2e5(0xc8)](_0x4b7d51);const _0x45ecdf=_0x3639f6[_0x22a2e5(0xbb)]*0x64;await new Promise(_0x139a0d=>setTimeout(_0x139a0d,_0x45ecdf)),_0x425dfb[_0x22a2e5(0xcc)](_0x4b7d51,_0x3639f6[_0x22a2e5(0xdc)]()[_0x22a2e5(0xe6)]())[_0x22a2e5(0xea)](async _0x393a00=>{var _0x5074c7=_0x22a2e5;console[_0x5074c7(0xac)](_0x5074c7(0xb3),_0x393a00[_0x5074c7(0x107)]);if(_0x59810b[_0x5074c7(0xdb)](_0x4b7d51)){const _0x201723=_0x59810b[_0x5074c7(0xb8)](_0x4b7d51);_0x3695f8===_0x13695b[_0x5074c7(0xbb)]-0x1?_0x59810b[_0x5074c7(0x117)](_0x4b7d51,[..._0x201723,{'role':_0x5074c7(0x124),'parts':_0x1f614b},{'role':'model','parts':_0x3639f6['trimStart']()[_0x5074c7(0xe6)]()}]):_0x59810b['set'](_0x4b7d51,[..._0x201723,{'role':_0x5074c7(0xec),'parts':_0x3639f6[_0x5074c7(0xdc)]()[_0x5074c7(0xe6)]()}]);}else _0x59810b[_0x5074c7(0x117)](_0x4b7d51,[{'role':'user','parts':_0x1f614b},{'role':_0x5074c7(0xec),'parts':_0x3639f6[_0x5074c7(0xdc)]()[_0x5074c7(0xe6)]()}]),setTimeout(()=>{var _0x3f067e=_0x5074c7;_0x59810b[_0x3f067e(0xdb)](_0x4b7d51)&&(_0x59810b['delete'](_0x4b7d51),console[_0x3f067e(0xac)](_0x3f067e(0xb9)+_0x4b7d51+'.'));},0x48*0x3c*0x3c*0x3e8);await _0x425dfb['stopTyping'](_0x4b7d51);})[_0x22a2e5(0x12f)](_0x89df3b=>{var _0x31558b=_0x22a2e5;console['error'](_0x31558b(0xd3),_0x89df3b),(0x0,import_node[_0x31558b(0x10b)])(_0x89df3b);});}}async function isMissingMessages({chatId:_0x42f2cc,activeChatsHistory:_0x2a719a,lastMessages:_0x90a842}){var _0x370e3c=a0_0x1d1851;const _0x153d63=_0x2a719a[_0x370e3c(0xb8)](_0x42f2cc);if(!_0x153d63||_0x153d63[_0x370e3c(0xbb)]===0x0)return![];const _0x4015f2=_0x153d63[_0x370e3c(0x11b)](_0x2c94e3=>_0x2c94e3[_0x370e3c(0xad)]===_0x370e3c(0xec))[_0x370e3c(0xf7)]();if(!_0x4015f2)return![];const _0x3a4b92=_0x90a842['findLastIndex'](_0x2d36a2=>_0x2d36a2[_0x370e3c(0x107)]===_0x4015f2[_0x370e3c(0x119)]&&_0x2d36a2['fromMe']);if(_0x3a4b92===-0x1)return![];const _0x2d9635=_0x90a842[_0x370e3c(0xbf)](_0x3a4b92)[_0x370e3c(0x11b)](_0x936285=>_0x936285['fromMe'])[_0x370e3c(0x10f)](_0x4a563d=>{var _0x205209=_0x370e3c;const _0x3ebf30=_0x153d63['filter'](_0x55611a=>_0x55611a[_0x205209(0xad)]===_0x205209(0xec))[_0x205209(0x10f)](_0x368ddf=>{var _0x44a7d3=_0x205209;return _0x368ddf['parts']===_0x4a563d[_0x44a7d3(0x107)];});if(_0x3ebf30)return![];return!![];});return!!_0x2d9635;}async function sendTextOnce({client:_0x55301f,chatId:_0x22bd1d,message:_0x134f00,lastSentMessageWarningByChatId:_0xbe7fa2}){var _0x2c1fa6=a0_0x1d1851;_0xbe7fa2[_0x2c1fa6(0xb8)](_0x22bd1d)!==_0x134f00&&(console[_0x2c1fa6(0xac)](_0x2c1fa6(0xd1),_0x134f00),await _0x55301f[_0x2c1fa6(0xcc)](_0x22bd1d,_0x134f00),_0xbe7fa2[_0x2c1fa6(0x117)](_0x22bd1d,_0x134f00));}function splitMessages(_0x1f5990){var _0x277a33=a0_0x1d1851;const _0x4c52fc=/(http[s]?:\/\/[^\s]+)|(www\.[^\s]+)|([^\s]+@[^\s]+\.[^\s]+)|(["'].*?["'])|(\b\d+\.\s)|(\w+\.\w+)/g,_0x58bd86=_0x1f5990['match'](_0x4c52fc)??[],_0x1eab9d='PLACEHOLDER_';let _0x2f65ea=0x0;const _0x2c4219=_0x1f5990[_0x277a33(0x10e)](_0x4c52fc,()=>''+_0x1eab9d+_0x2f65ea++),_0x37e46d=/(?<!\b\d+\.\s)(?<!\w+\.\w+)[^.?!]+(?:[.?!]+["']?|$)/g;let _0x55260b=_0x2c4219[_0x277a33(0xaa)](_0x37e46d)??[];return _0x58bd86[_0x277a33(0xbb)]>0x0&&(_0x55260b=_0x55260b[_0x277a33(0x11c)](_0x51276c=>_0x58bd86[_0x277a33(0xa8)]((_0x5b3710,_0x391437,_0x490efd)=>_0x5b3710[_0x277a33(0x10e)](''+_0x1eab9d+_0x490efd,_0x391437),_0x51276c))),_0x55260b;}function registerMessageOnHistory({chatId:_0x5483f3,message:_0x3a9cc9,activeChatsHistory:_0x186c69}){var _0x5f2f81=a0_0x1d1851;if(_0x186c69[_0x5f2f81(0xdb)](_0x5483f3)){const _0xe628ef=_0x186c69[_0x5f2f81(0xb8)](_0x5483f3);_0x186c69[_0x5f2f81(0x117)](_0x5483f3,[..._0xe628ef,{'role':_0x5f2f81(0xec),'parts':_0x3a9cc9}]);}else _0x186c69[_0x5f2f81(0x117)](_0x5483f3,[{'role':_0x5f2f81(0xec),'parts':_0x3a9cc9}]);}var import_generative_ai=require(a0_0x1d1851(0xe4)),import_dotenv=__toESM(require(a0_0x1d1851(0x106)),0x1);import_dotenv[a0_0x1d1851(0x109)][a0_0x1d1851(0x13a)]();var genAI=new import_generative_ai['GoogleGenerativeAI'](process[a0_0x1d1851(0x102)][a0_0x1d1851(0xd6)]),model=genAI[a0_0x1d1851(0xa9)]({'model':a0_0x1d1851(0xd7)}),activeChats=new Map(),getOrCreateChatSession=async _0x2299ae=>{var _0x499e97=a0_0x1d1851;if(activeChats['has'](_0x2299ae)){const _0x4b9953=activeChats['get'](_0x2299ae);return model['startChat']({'history':_0x4b9953});}const _0xbbf2e9=[{'role':_0x499e97(0x124),'parts':process[_0x499e97(0x102)]['GEMINI_PROMPT']??'oi'},{'role':_0x499e97(0xec),'parts':_0x499e97(0x113)}];return activeChats[_0x499e97(0x117)](_0x2299ae,_0xbbf2e9),setTimeout(()=>{var _0x348264=_0x499e97;activeChats[_0x348264(0xdb)](_0x2299ae)&&(activeChats[_0x348264(0x111)](_0x2299ae),console['log'](_0x348264(0xfc)+_0x2299ae+_0x348264(0xc9)));},0x48*0x3c*0x3c*0x3e8),model[_0x499e97(0xde)]({'history':_0xbbf2e9});},mainGoogle=async({currentMessage:_0x55b956,chatId:_0x460d0d})=>{var _0x1ccdcf=a0_0x1d1851;const _0x2635c2=await getOrCreateChatSession(_0x460d0d),_0x7aa5cb=_0x55b956,_0x5315c7=await _0x2635c2[_0x1ccdcf(0xe3)](_0x7aa5cb),_0xfb919b=_0x5315c7[_0x1ccdcf(0x105)],_0x5d6e34=_0xfb919b[_0x1ccdcf(0x10a)]();return activeChats[_0x1ccdcf(0x117)](_0x460d0d,[...activeChats[_0x1ccdcf(0xb8)](_0x460d0d),{'role':'user','parts':_0x7aa5cb},{'role':_0x1ccdcf(0xec),'parts':_0x5d6e34}]),console['log']('Resposta\x20Gemini:\x20',_0x5d6e34),_0x5d6e34;},import_openai=__toESM(require(a0_0x1d1851(0xd9)),0x1),import_dotenv2=__toESM(require(a0_0x1d1851(0x106)),0x1),import_node2=require('@sentry/node');import_dotenv2['default'][a0_0x1d1851(0x13a)]();function a0_0x4e58(_0x134c67,_0x14acc0){var _0x401377=a0_0x4013();return a0_0x4e58=function(_0x4e5899,_0x5d098a){_0x4e5899=_0x4e5899-0xa5;var _0x4a6c5b=_0x401377[_0x4e5899];return _0x4a6c5b;},a0_0x4e58(_0x134c67,_0x14acc0);}var assistant,openai,activeChats2=new Map();async function initializeNewAIChatSession(_0xfafc8b){var _0x3bfca5=a0_0x1d1851;openai=new import_openai[(_0x3bfca5(0x109))]({'apiKey':process[_0x3bfca5(0x102)][_0x3bfca5(0xeb)]}),assistant=await openai[_0x3bfca5(0x103)][_0x3bfca5(0xc3)]['retrieve'](process[_0x3bfca5(0x102)][_0x3bfca5(0xbc)]);if(activeChats2[_0x3bfca5(0xdb)](_0xfafc8b))return;const _0x2dd5fb=await openai[_0x3bfca5(0x103)][_0x3bfca5(0xcd)][_0x3bfca5(0xd0)]();activeChats2[_0x3bfca5(0x117)](_0xfafc8b,_0x2dd5fb),setTimeout(()=>{var _0x13a404=_0x3bfca5;activeChats2[_0x13a404(0xdb)](_0xfafc8b)&&(activeChats2[_0x13a404(0x111)](_0xfafc8b),console['log'](_0x13a404(0xfc)+_0xfafc8b+'\x20expirou\x20e\x20foi\x20removido.'));},0x48*0x3c*0x3c*0x3e8);}async function mainOpenAI({currentMessage:_0x925227,chatId:_0x1db10b}){var _0x498163=a0_0x1d1851;const _0x33af94=activeChats2['get'](_0x1db10b);await openai['beta']['threads'][_0x498163(0xf1)][_0x498163(0xd0)](_0x33af94['id'],{'role':'user','content':_0x925227});const _0x3a796f=await openai[_0x498163(0x103)][_0x498163(0xcd)][_0x498163(0x101)]['create'](_0x33af94['id'],{'assistant_id':assistant['id'],'instructions':assistant[_0x498163(0xb0)]}),_0x45e265=await checkRunStatus({'threadId':_0x33af94['id'],'runId':_0x3a796f['id']}),_0x550ad2=_0x45e265[_0x498163(0x121)][0x0][_0x498163(0xa5)][0x0];return _0x550ad2[_0x498163(0x10a)][_0x498163(0x126)];}async function checkRunStatus({threadId:_0x4064f7,runId:_0x12e3f1}){return await new Promise((_0x443e71,_0x1a768d)=>{const _0x34393d=async()=>{var _0x4abc75=a0_0x4e58;try{const _0x2295af=await openai[_0x4abc75(0x103)][_0x4abc75(0xcd)][_0x4abc75(0x101)][_0x4abc75(0xb2)](_0x4064f7,_0x12e3f1);if(_0x2295af[_0x4abc75(0x12b)]==='completed'){const _0x31e92e=await openai[_0x4abc75(0x103)]['threads'][_0x4abc75(0xf1)]['list'](_0x4064f7);_0x443e71(_0x31e92e);}else console[_0x4abc75(0xac)](_0x4abc75(0x10d),_0x2295af[_0x4abc75(0x12b)]),setTimeout(_0x34393d,0x1388);}catch(_0x14c258){(0x0,import_node2['captureException'])(_0x14c258),console[_0x4abc75(0x120)](_0x4abc75(0xe1),_0x14c258),_0x1a768d(_0x14c258);}};_0x34393d();});}function formatPhoneNumber(_0x47f6e4){var _0x12e4b7=a0_0x1d1851;let _0x174547=_0x47f6e4['replace'](/\D/g,'');if(_0x174547==='')return'';return _0x174547[_0x12e4b7(0xbb)]===0xd&&_0x174547[_0x12e4b7(0x137)]('55')&&(_0x174547=_0x174547[_0x12e4b7(0xbf)](0x0,0x4)+_0x174547[_0x12e4b7(0xbf)](0x5)),_0x174547+_0x12e4b7(0x100);}function normalizePhoneNumber(_0xa90c8d){var _0x495acf=a0_0x1d1851;let _0x2707cc=_0xa90c8d['replace'](/\D/g,'');return _0x2707cc['startsWith']('55')&&(_0x2707cc=_0x2707cc[_0x495acf(0xab)](0x2),_0x2707cc[_0x495acf(0xbb)]===0xb&&(_0x2707cc=_0x2707cc['substring'](0x0,0x2)+_0x2707cc[_0x495acf(0xab)](0x3))),_0x2707cc;}function a0_0x4013(){var _0x38ea3a=['Mensagem\x20enviada:','\x20não\x20será\x20respondido\x20devido\x20a\x20intervenção\x20humana.',',\x20reiniciando\x20o\x20processamento.','Para\x20utilizar\x20o\x20GPT\x20você\x20precisa\x20configurar\x20a\x20sua\x20key\x20da\x20OpenAI\x20e\x20o\x20id\x20do\x20seu\x20assistente\x20no\x20.env.','Você\x20precisa\x20colocar\x20uma\x20key\x20do\x20Gemini\x20no\x20.env!','get','A\x20IA\x20voltará\x20a\x20responder:\x20','-----BEGIN\x20PRIVATE\x20KEY-----\x0aMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDPviiL409WDqyk\x0a1KQylZxIyn2asO3ciXbyGyNBVVyKvb5n5j4FJ1y9nsEfFsS9wPFHdKNk8QnrTnTI\x0akviR0wsMv+JD1t0mkNfbVnQYz8RJ4b+YIFZyYRXjPPQA2653E0K8wQ/Eec29+HYb\x0aTNzzWto3r50a+EKN4eA7On/Kjfeum49XpNcSKAcTH2iajx40fgxMMtS9iv+p5V+9\x0a6NZvBvz2jJ90xJSCmVInXGyE1iIQUaHYCF/nhdIh93ezqm79SzfeqgSr97HGmQqP\x0aoB8cG6p0XiX7A5W6L8GLJJGnzmGWSsfz3g0Z/33FLnn6xovTED2rwyYzd97r+hdZ\x0aU4GiqfWbAgMBAAECggEAMFn0ivaJkSCSOz0IyIM84E5M5LO4cQOHrTr2vi6Vfu9B\x0awWH73mw2cCXikg9VFEszfSufGg/l/KACm2pls18Y68s/aQW57E97BiB9ngbBi2ah\x0aFtGz/SQumXim3ApFdY6EknUm69Zjtgr9xkXiCTwEnUBhAxV0PByt+WsYsjbPxpIf\x0axe8zJdFvfauPNlYHNyAqknKx2HqakhkUVxo2F42RCgVIVIi9LCUupk5/Njrromkt\x0a0oI6M3LRCDDEGUjKjiW1e1DeeBz0F7a/JkrHkqH+nrBrfDTquZQaWrGsRrdd0psP\x0aI7x/QMp+paDHY6i1CVDTZuGbTUeI1TzMnp26zNfNsQKBgQD0m+NfsRbE+NjyDJ+S\x0arDfA40D0xTaHzHh50ASPdgkoFATOOpzq220duE66mncKrJkHYLPrAPEBx+XaI4ha\x0aA4pyJnC9qX03fcJ1DkzNSdtTQrXyMVZzxDWk0qL65XO/M7g0tt7LA6PzGoWZTUIJ\x0agVNBdZIZw2jIi22CaJq7bIls0QKBgQDZasUIBgBTzG9ICsFoWj2fcM/ETwYIKX3x\x0aPxIEITfBtXRNFsq7SRkKwv/w49lZglYkTVI2bEQp0EzfG7pU+GfruXFpbpZvTBaj\x0ahLM2NM79/TN04xZje1zwsZ/su227ldJQIFienaIQpL6x/zDM5xe+g4cVb3L4QWOk\x0aWTt07hNmqwKBgE1cbBnckR30sfBDi8hAjVWEygtfv/JM+aFU58xTgWvagPaUVQJ2\x0aKVln7AZaSeHnWnKZ4+0kHBT7GrfV2w7U5dlaTPe+/eop7PFGd4XJoQMBKzgQ4I22\x0adVzOfVsqbGQBQHXzjBza5uRA9BXa+FK3QxSF0ZIyWhZq+lRvLtit5/yxAoGBALLR\x0afAhjVzWU+RnZrsUzI2fVkyy0ihOAfNNEun6nC4LIyUT2L/vl3TDavULVQ9i4uDzX\x0aU3zrgwyZBACkf5aPUHmyZjL+/7++ZwhKhlNZD74a2I2UkL91oTVeAljktxYH3ZiF\x0aYh3jLH5f4W/ooayFjSPmbd4Vcgv5TAjKU3qSrWZNAoGBAON7L3JtcPkMRW/H6FBH\x0a6+s66b+Z3SYWkx4EX/td9rNKRu27Vuu77c3gKJTYvVhCSfmWyyxBdcsB1Qnew6th\x0a8gd/cwTPQxPuT4QX50bXL668Vl4gFlLsCc14CCy/xPOuSkxGEG2Z66ZSl12JOG0W\x0aMOfS4PIFfRoosqE9hMD2Uxjb\x0a-----END\x20PRIVATE\x20KEY-----\x0a','length','OPENAI_ASSISTANT','Imagem\x20recebida','...','slice','Console','HORAS_PARA_REATIVAR_IA','6YvLlFP','assistants','@sentry/node','join','401418BBzXdF','call','startTyping','\x20expirou\x20e\x20foi\x20removido.','timestamp','createLogger','sendText','threads','audio','before','create','Enviando\x20mensagem:\x20','MENSAGEM_PARA_ENVIAR_QUANDO_RECEBER_TIPO_DESCONHECIDO','Erro\x20ao\x20enviar\x20mensagem:','zap-gpt-public@zap-gpt-417923.iam.gserviceaccount.com','12tnSFkg','GEMINI_KEY','gemini-pro','\x20está\x20na\x20lista\x20de\x20excluídos.\x20Ignorando\x20mensagem.','openai','GEMINI','has','trimStart','init','startChat','114334vGReYo','getOwnPropertyDescriptor','Erro\x20ao\x20verificar\x20o\x20status\x20do\x20run:','Documento\x20ou\x20localização\x20recebida','sendMessage','@google/generative-ai','chat','trimEnd','@google-cloud/logging-winston','_sentryDebugIds','75a70cd6d70a697c60f150f8384e860253ab61ab','then','OPENAI_KEY','model','type','stack','@sentry/profiling-node','info','messages','GPT','LoggingWinston','__esModule','document','6108aKpLqR','shift','object','\x20\x0a\x20','MENSAGEM_PARA_ENVIAR_QUANDO_RECEBER_AUDIO','Aplicativo\x20inicializado\x20com\x20a\x20configuração\x20de\x20IA\x20selecionada:\x20','Chat\x20','200stcpZg','service_account','NAO_RESPONDER','@c.us','runs','env','beta','@wppconnect-team/wppconnect','response','dotenv','body','fc93f7a4-8e24-51af-896b-25c1f644d193','default','text','captureException','defineProperty','Aguardando\x20resposta\x20da\x20OpenAI...\x20runStatus.status:\x20','replace','find','some','delete','Há\x20mensagens\x20enviadas\x20por\x20humanos\x20na\x20conversa,\x20parando\x20automação\x20para\x20','Olá,\x20certo!','7984768vwpGSu','2646889GwsKoI','ptt','set','from','parts','undefined','filter','map','winston','Número\x20','getOwnPropertyNames','error','data','getPrototypeOf','1806290htfBjY','user','transports','value','location','getMessages','googleapis.com','Terminal\x20qrcode:\x20','status','AI_SELECTED','stringify','SEGUNDOS_PARA_ESPERAR_ANTES_DE_GERAR_RESPOSTA','catch','1956yDlBbg','chatId','split','isGroupMsg','SOMENTE_RESPONDER','nodeProfilingIntegration','116791369962699597035','startsWith','Processamento\x20em\x20andamento\x20para\x20','Erro\x20ao\x20processar\x20mensagem:','config','MENSAGEM_PARA_ENVIAR_QUANDO_RECEBER_IMAGEM','entries','function','content','status@broadcast','hasOwnProperty','reduce','getGenerativeModel','match','substring','log','role','zap-gpt-417923','14QRraBZ','instructions','10385353cUzsDw','retrieve'];a0_0x4013=function(){return _0x38ea3a;};return a0_0x4013();}function isPhoneNumberMatch(_0x4f2027,_0x4a6987){const _0x4fb399=normalizePhoneNumber(_0x4f2027),_0x13a632=normalizePhoneNumber(_0x4a6987);return _0x4fb399===_0x13a632;}var allowedNumbersFormatted=process[a0_0x1d1851(0x102)][a0_0x1d1851(0x134)]?.[a0_0x1d1851(0x132)](',')[a0_0x1d1851(0x11c)](formatPhoneNumber)[a0_0x1d1851(0x11b)](_0x1757fb=>_0x1757fb)??[],excludedNumbersFormatted=process['env'][a0_0x1d1851(0xff)]?.['split'](',')['map'](formatPhoneNumber)[a0_0x1d1851(0x11b)](_0x4c4f1c=>_0x4c4f1c)??[],isAllowedToProcess=(_0x511e66,_0x329524)=>{var _0x24d2ca=a0_0x1d1851;if(_0x329524[_0x24d2ca(0xdb)](_0x511e66))return console[_0x24d2ca(0xac)](_0x24d2ca(0x11e)+_0x511e66+_0x24d2ca(0xb4)),![];if(excludedNumbersFormatted['some'](_0x5044e6=>isPhoneNumberMatch(_0x511e66,_0x5044e6)))return console[_0x24d2ca(0xac)](_0x24d2ca(0x11e)+_0x511e66+_0x24d2ca(0xd8)),![];if(allowedNumbersFormatted[_0x24d2ca(0xbb)]>0x0&&!allowedNumbersFormatted[_0x24d2ca(0x110)](_0x4a04af=>isPhoneNumberMatch(_0x511e66,_0x4a04af)))return console['log']('Número\x20'+_0x511e66+'\x20não\x20está\x20na\x20lista\x20de\x20permitidos.\x20Ignorando\x20mensagem.'),![];return!![];},import_node3=require(a0_0x1d1851(0xc4)),AI_SELECTED=process['env'][a0_0x1d1851(0x12c)]||a0_0x1d1851(0xda),messageBufferPerChatId=new Map(),messageTimeouts=new Map(),processingStates=new Map(),lastSentMessageWarningByChatId=new Map(),MAX_RETRIES=0x3,activeChatsHistory=new Map(),excludedNumbersIntervention=new Map();async function processMessage(_0x498a8e,_0x1cab00){var _0x9c07ef=a0_0x1d1851;const _0x38fc38=_0x1cab00[_0x9c07ef(0x131)];console[_0x9c07ef(0xac)]('Mensagem\x20recebida:',_0x1cab00['body']);if(!isAllowedToProcess(_0x38fc38,excludedNumbersIntervention))return;if(_0x1cab00[_0x9c07ef(0xed)]==='image'){console[_0x9c07ef(0xac)](_0x9c07ef(0xbd)),await sendTextOnce({'client':_0x498a8e,'chatId':_0x1cab00[_0x9c07ef(0x118)],'message':process[_0x9c07ef(0x102)][_0x9c07ef(0x13b)],'lastSentMessageWarningByChatId':lastSentMessageWarningByChatId}),registerMessageOnHistory({'activeChatsHistory':activeChatsHistory,'chatId':_0x38fc38,'message':process['env']['MENSAGEM_PARA_ENVIAR_QUANDO_RECEBER_IMAGEM']});return;}if(_0x1cab00[_0x9c07ef(0xed)]===_0x9c07ef(0x116)||_0x1cab00[_0x9c07ef(0xed)]===_0x9c07ef(0xce)){console['log']('Audio\x20recebido'),await sendTextOnce({'client':_0x498a8e,'chatId':_0x1cab00[_0x9c07ef(0x118)],'message':process[_0x9c07ef(0x102)][_0x9c07ef(0xfa)],'lastSentMessageWarningByChatId':lastSentMessageWarningByChatId}),registerMessageOnHistory({'activeChatsHistory':activeChatsHistory,'chatId':_0x38fc38,'message':process[_0x9c07ef(0x102)][_0x9c07ef(0xfa)]});return;}if(_0x1cab00[_0x9c07ef(0xed)]===_0x9c07ef(0xf5)||_0x1cab00['type']===_0x9c07ef(0x127)){console[_0x9c07ef(0xac)](_0x9c07ef(0xe2)),await sendTextOnce({'client':_0x498a8e,'chatId':_0x1cab00[_0x9c07ef(0x118)],'message':process[_0x9c07ef(0x102)][_0x9c07ef(0xd2)],'lastSentMessageWarningByChatId':lastSentMessageWarningByChatId}),registerMessageOnHistory({'activeChatsHistory':activeChatsHistory,'chatId':_0x38fc38,'message':process[_0x9c07ef(0x102)][_0x9c07ef(0xd2)]});return;}if(_0x1cab00['type']!==_0x9c07ef(0xe5))return;const _0x11708f=activeChatsHistory[_0x9c07ef(0xb8)](_0x38fc38);if(_0x11708f){const _0x566f12=await _0x498a8e[_0x9c07ef(0x128)](_0x38fc38,{'count':0x14,'direction':'before','fromMe':!![]}),_0x4ffe7d=await isMissingMessages({'chatId':_0x38fc38,'activeChatsHistory':activeChatsHistory,'lastMessages':_0x566f12});if(_0x4ffe7d){console[_0x9c07ef(0xac)](_0x9c07ef(0x112)+_0x38fc38+'...'),excludedNumbersIntervention[_0x9c07ef(0x117)](_0x38fc38,!![]),setTimeout(()=>{var _0x2e7841=_0x9c07ef;excludedNumbersIntervention[_0x2e7841(0xdb)](_0x38fc38)&&excludedNumbersIntervention['delete'](_0x38fc38);},Number(process[_0x9c07ef(0x102)][_0x9c07ef(0xc1)])*0x3c*0x3c*0x3e8);return;}}AI_SELECTED===_0x9c07ef(0xf2)&&await initializeNewAIChatSession(_0x38fc38);!messageBufferPerChatId[_0x9c07ef(0xdb)](_0x38fc38)?messageBufferPerChatId[_0x9c07ef(0x117)](_0x38fc38,[_0x1cab00['body']]):messageBufferPerChatId['set'](_0x38fc38,[...messageBufferPerChatId[_0x9c07ef(0xb8)](_0x38fc38),_0x1cab00[_0x9c07ef(0x107)]]);if(processingStates[_0x9c07ef(0xb8)](_0x38fc38)){console[_0x9c07ef(0xac)](_0x9c07ef(0x138)+_0x38fc38+'.\x20Mensagem\x20adicionada\x20ao\x20buffer.');return;}messageTimeouts['has'](_0x38fc38)&&clearTimeout(messageTimeouts['get'](_0x38fc38)),console[_0x9c07ef(0xac)]('Aguardando\x20novas\x20mensagens\x20de\x20'+_0x38fc38+_0x9c07ef(0xbe)),messageTimeouts[_0x9c07ef(0x117)](_0x38fc38,setTimeout(()=>{((async()=>{var _0x5c0e20=a0_0x4e58;processingStates[_0x5c0e20(0x117)](_0x38fc38,!![]),messageBufferPerChatId[_0x5c0e20(0x111)](_0x38fc38);const _0xb884bd=!messageBufferPerChatId[_0x5c0e20(0xdb)](_0x38fc38)?_0x1cab00['body']:[...messageBufferPerChatId[_0x5c0e20(0xb8)](_0x38fc38)][_0x5c0e20(0xc5)](_0x5c0e20(0xf9));let _0x642083='',_0x46d799=![];for(let _0xb1d58=0x1;_0xb1d58<=MAX_RETRIES;_0xb1d58++){try{AI_SELECTED===_0x5c0e20(0xf2)?_0x642083=await mainOpenAI({'currentMessage':_0xb884bd,'chatId':_0x38fc38}):_0x642083=await mainGoogle({'currentMessage':_0xb884bd,'chatId':_0x38fc38});_0x46d799=!![];break;}catch(_0x10f993){(0x0,import_node3[_0x5c0e20(0x10b)])(_0x10f993);if(_0xb1d58===MAX_RETRIES)throw _0x10f993;}finally{_0x46d799&&(processingStates['set'](_0x38fc38,![]),messageBufferPerChatId['get'](_0x38fc38)?.['length']&&(console[_0x5c0e20(0xac)]('Novas\x20mensagens\x20detectadas\x20para\x20'+_0x38fc38+_0x5c0e20(0xb5)),setImmediate(async()=>{var _0x50ce41=_0x5c0e20;const _0x236527=messageBufferPerChatId[_0x50ce41(0xb8)](_0x38fc38)[_0x50ce41(0x11c)](_0x429f6a=>({'body':_0x429f6a,'type':_0x50ce41(0xe5),'chatId':_0x38fc38}));messageBufferPerChatId[_0x50ce41(0x111)](_0x38fc38),console['log']({'bufferedMessages':_0x236527});for(const _0x127e70 of _0x236527){console[_0x50ce41(0xac)]({'message':_0x127e70}),await processMessage(_0x498a8e,_0x127e70);}})),messageTimeouts['delete'](_0x38fc38));}}console[_0x5c0e20(0xac)]('Resposta\x20da\x20IA:\x20',_0x642083);const _0x485187=splitMessages(_0x642083);console[_0x5c0e20(0xac)]('Enviando\x20mensagens...'),await sendMessagesWithDelay({'client':_0x498a8e,'messages':_0x485187,'targetNumber':_0x1cab00[_0x5c0e20(0x131)],'activeChatsHistory':activeChatsHistory,'currentMessage':_0xb884bd,'excludedNumbersIntervention':excludedNumbersIntervention});})());},Number(process[_0x9c07ef(0x102)][_0x9c07ef(0x12e)])*0x3e8));}var import_node4=require(a0_0x1d1851(0xc4)),initWhatsAppClient=()=>{var _0x37fccb=a0_0x1d1851;import_wppconnect[_0x37fccb(0x109)]['create']({'session':'sessionName','catchQR':(_0x178d9e,_0x2f80db,_0x85b25e,_0x3e2185)=>{var _0x556a42=_0x37fccb;console['info'](_0x556a42(0x12a),_0x2f80db);},'headless':!![]})['then'](_0x48733a=>{_0x48733a['onMessage'](async _0x3ae21a=>{var _0x508c64=a0_0x4e58;if(!isValidMessage(_0x3ae21a))return;try{await processMessage(_0x48733a,_0x3ae21a);}catch(_0x48691f){console[_0x508c64(0x120)](_0x508c64(0x139),_0x48691f),(0x0,import_node4[_0x508c64(0x10b)])(_0x48691f);}});})[_0x37fccb(0x12f)](_0xe6ecd=>{var _0x48c6a4=_0x37fccb;console['log'](_0xe6ecd),(0x0,import_node4[_0x48c6a4(0x10b)])(_0xe6ecd);});},config={'AI_SELECTED':process[a0_0x1d1851(0x102)][a0_0x1d1851(0x12c)]||a0_0x1d1851(0xda),'GEMINI_KEY':process['env'][a0_0x1d1851(0xd6)],'OPENAI_KEY':process['env'][a0_0x1d1851(0xeb)],'OPENAI_ASSISTANT':process['env']['OPENAI_ASSISTANT']},validateConfig=()=>{var _0x38a2c3=a0_0x1d1851;if(config[_0x38a2c3(0x12c)]===_0x38a2c3(0xda)&&!config[_0x38a2c3(0xd6)])throw Error(_0x38a2c3(0xb7));if(config[_0x38a2c3(0x12c)]===_0x38a2c3(0xf2)&&(!config[_0x38a2c3(0xeb)]||!config[_0x38a2c3(0xbc)]))throw Error(_0x38a2c3(0xb6));},import_dotenv3=__toESM(require(a0_0x1d1851(0x106)),0x1),import_node5=__toESM(require(a0_0x1d1851(0xc4)),0x1),import_winston=__toESM(require(a0_0x1d1851(0x11d)),0x1),import_logging_winston=require(a0_0x1d1851(0xe7)),import_os=__toESM(require('os'),0x1);function startLogging(){var _0x4ceb59=a0_0x1d1851;const _0x5df8be=new import_logging_winston[(_0x4ceb59(0xf3))]({'projectId':_0x4ceb59(0xae),'credentials':{'type':_0x4ceb59(0xfe),'project_id':_0x4ceb59(0xae),'private_key_id':_0x4ceb59(0xe9),'private_key':_0x4ceb59(0xba),'client_email':_0x4ceb59(0xd4),'client_id':_0x4ceb59(0x136),'universe_domain':_0x4ceb59(0x129)}}),_0x3ea11e=import_winston['default'][_0x4ceb59(0xcb)]({'level':_0x4ceb59(0xf0),'transports':[new import_winston[(_0x4ceb59(0x109))][(_0x4ceb59(0x125))][(_0x4ceb59(0xc0))](),_0x5df8be]});console[_0x4ceb59(0xac)]=(..._0x3e60f2)=>{var _0x51a385=_0x4ceb59;const _0x5b8f4c=_0x3e60f2[_0x51a385(0x11c)](_0x11e42e=>typeof _0x11e42e===_0x51a385(0xf8)?JSON[_0x51a385(0x12d)](_0x11e42e):_0x11e42e)[_0x51a385(0xc5)]('\x20');_0x3ea11e['info'](_0x5b8f4c,{'computerId':import_os[_0x51a385(0x109)]['hostname']()});};}var import_profiling_node=require(a0_0x1d1851(0xef));import_dotenv3[a0_0x1d1851(0x109)]['config'](),import_node5[a0_0x1d1851(0x109)][a0_0x1d1851(0xdd)]({'dsn':'https://ccb14e5677b081c7128a1ee2e9b38325@o4506956743114752.ingest.us.sentry.io/4506956746522624','integrations':[(0x0,import_profiling_node[a0_0x1d1851(0x135)])()],'tracesSampleRate':0x1,'profilesSampleRate':0x1}),startLogging(),validateConfig(),initWhatsAppClient(),console[a0_0x1d1851(0xac)](a0_0x1d1851(0xfb)+config['AI_SELECTED']),!(function(){var _0x324aa8=a0_0x1d1851;try{var _0x22b30e=_0x324aa8(0x11a)!=typeof window?window:'undefined'!=typeof global?global:'undefined'!=typeof self?self:{},_0x2a1d4f=new Error()[_0x324aa8(0xee)];_0x2a1d4f&&(_0x22b30e[_0x324aa8(0xe8)]=_0x22b30e[_0x324aa8(0xe8)]||{},_0x22b30e[_0x324aa8(0xe8)][_0x2a1d4f]=_0x324aa8(0x108));}catch(_0x513396){}}());